<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event Details</title>
    <!-- Load the Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
      // Client ID from the Google Cloud Console
      const CLIENT_ID =
        "165118313321-d00r22in46quqe9gvn6ub0a8hmdl72do.apps.googleusercontent.com";
      // The discovery URL for the Google Sheets API
      const DISCOVERY_URL =
        "https://sheets.googleapis.com/$discovery/rest?version=v4";
      // The range of data you want to retrieve
      const RANGE = "A1:N"; // Assuming data starts from row 1 and spans columns A to N

      // Function to load Google Sheets data
      function loadSheetsData() {
        gapi.client
          .init({
            apiKey: "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",
            clientId: CLIENT_ID,
            discoveryDocs: [DISCOVERY_URL],
            scope: "https://www.googleapis.com/auth/spreadsheets.readonly",
          })
          .then(function () {
            // Get the data from Google Sheets
            return gapi.client.sheets.spreadsheets.values.get({
              spreadsheetId: "1ERTXiKMbF18rY9mR976hQGrJ4pkmfPzlzVhaSeyebII",
              range: "Sheet1!" + RANGE,
            });
          })
          .then(
            function (response) {
              var range = response.result;
              if (range.values.length > 0) {
                var values = range.values;
                // Assuming submissionID exists in the first column (A)
                var rowData = values.find((row) => row[0] === "0JeByQ");
                if (rowData) {
                  var payloadIndex = values[0].indexOf("Payload"); // Find the index of the 'Payload' header
                  if (payloadIndex !== -1) {
                    displayData(rowData[payloadIndex]);
                  } else {
                    displayError("Payload column not found");
                  }
                } else {
                  displayError("Submission ID not found");
                }
              } else {
                displayError("No data found");
              }
            },
            function (response) {
              console.error("Error loading Google Sheets API:", response);
              displayError("Failed to load data");
            }
          );
      }

      // Function to display data on the page
      function displayData(payload) {
        var container = document.getElementById("data");
        container.innerHTML = "<pre>" + payload + "</pre>"; // Display JSON content
      }

      // Function to display error message on the page
      function displayError(message) {
        var container = document.getElementById("data");
        container.innerHTML = "<p>" + message + "</p>";
      }

      // Initialize the API client and make a request to Google Sheets API
      function handleClientLoad() {
        gapi.load("client", loadSheetsData);
      }
    </script>
  </head>
  <body>
    <h1>Event Details</h1>
    <div id="data"></div>

    <!-- Initialize the API client -->
    <script
      async
      defer
      src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()"
    ></script>
  </body>
</html>
